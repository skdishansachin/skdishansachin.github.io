---
import { getCollection } from 'astro:content';
import BaseHead from '@/components/BaseHead.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Header from '@/components/Header.astro';
import Nav from '@/components/Nav.astro';
import { SITE_DESCRIPTION } from '@/consts';

const posts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const tagMap = new Map();

for (const post of posts) {
  const tags = post.data.tags || [];
  for (const tag of tags) {
    if (!tagMap.has(tag)) {
      tagMap.set(tag, []);
    }
    tagMap.get(tag).push(post);
  }
}
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title="Tags" description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header>
      <Nav />
    </Header>
    <h1>Filter by tag</h1>
    <ul>
      {[...tagMap.entries()].map(([tag, posts]) => (
        <li>
          <a href={`/tags/${tag}`}>
            {tag} ({posts.length})
          </a>
        </li>
      ))}
    </ul>
  </body>
</html>

<style>
  h1 {
        font-size: 1.2rem;
        margin-bottom: 0;
        font-weight: 400;
    }
    
  ul {
    list-style-type: none;
    padding: 0;
  }

  ul li {
    display: flex;
    gap: 1em;
  }

  ul li a:visited {
    color: var(--visited-color);
  }
</style>